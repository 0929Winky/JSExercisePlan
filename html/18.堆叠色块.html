<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>18.色块堆叠</title>
		<link rel="stylesheet" type="text/css" href="../css/reset.css"/>
		<link rel="stylesheet" type="text/css" href="../css/bttn.css"/>
		<script src="../js/myPackage.js" type="text/javascript" charset="utf-8"></script>
		<style type="text/css">
			*{
				box-sizing: border-box;
			}
			body{
				background: #666;
			}
			.container{
				width: 624px;
				height: 624px;
				margin: 0 auto;
				padding: 10px;
				background: #EFEFEF;
				border-radius: 10px;
				box-shadow: 5px 5px 10px #000;
			}
			.show{
				float: left;
				width: 200px;
				height: 100%;
				padding: 50px 0 0 20px;
			}
			.show p{
				font-size: 40px;
				margin-top: 10px;
				font-weight: bold;
			}
			.show button{
				width: 140px;
				height: 50px;
				margin: 10px;
			}
			.main{
				position: relative;
				float: left;
				width: 404px;
				height: 604px;
				border: 2px solid #000;
				background: #333;
			}
			.main div{
				position: absolute;
				width: 80px;
				height: 50px;
			}
		</style>
	</head>
	<body>
		<h1>18.色块堆叠</h1>
		<a href="../index.html">返还打卡</a>
		<hr />
		<div class="container">
			<div class="show">
				<p>Score:</p>
				<p id="score">
					显示分数
				</p>
				<br />
				<p>Lv:</p>
				<p id="score">
					显示等级
				</p>
				<br />
				<button class="bttn-success bttn-fill">开始</button>
				<br />
				<button class="bttn-danger bttn-fill">记录</button>
				<br />
			</div>
			<div class="main" id='main'>
				
			</div>
		</div>
		<script type="text/javascript">
			var btn = document.getElementsByTagName('button');
			var main = document.getElementById('main');
			var color = ['#ffffcc','#ffff99','#ffcc33','#ff9900','#ff6600'];
			var brick = main.children;
			var cols = new Array();//初始化航道数组
			var col = 2;//初始化航道为3
			var speed = 7;//初始化速度为10
			var bar = 3;//初始化随机模块为3种
			var Lv = 1;
			var score = 0;
			var timer1 = null;//砖块下降定时器
			var timer2 = null;//砖块左右移动定时器
			//初始化航道
			for(var i=0;i<5;i++){
				cols[i] = new Array();
			}
			
			//点击开始
			btn[0].onclick = function(){
				Create();
			}
			
			//键盘事件
			document.onkeydown = function(event){
				var Event = event||window.event;
				console.log(Event.keyCode);
				switch(Event.keyCode){
					case 37://左方向键
						Change(brick[brick.length-1],true);
						console.log('左移');
						break;
					case 39://右方向键
						Change(brick[brick.length-1],false);
						console.log('右移');
						break;
					case 40://下方向键
						Down(brick[brick.length-1]);
						console.log('下落');
						break;
				}
			}
			
			//生成色块
			function Create(){
				var r = Math.floor(Math.random()*(bar));
				var newbrick = document.createElement('div');
				col = 2;//初始化砖块位置
				newbrick.style.backgroundColor = color[r];
				newbrick.style.left = '160px';
				newbrick.style.top = '0';
				main.appendChild(newbrick);
				console.log(brick[brick.length-1]);
				Move(brick[brick.length-1]);
			}
			//色块下降
			function Move(ele){
				var bt = 0; 
				var target = 550;
				clearInterval(timer1);
				timer1 = setInterval(function(){
					bt+=speed;
					ele.style.top = bt+'px';
					if(bt == target){
						clearInterval(timer1);
						var timer = setTimeout(function(){
							clearTimeout(timer);
							Create();
						},300)
					}
				},20);
			}
			//左右移动
			function Change(ele,dir){
				var bl = col*80;
				if(dir){
					col = col==0?0:col-1;
					timer2 = setInterval(function(){
						bl = bl==0?bl=0:bl-10;
						ele.style.left = bl+'px';
						if(bl == col*80){
							clearInterval(timer2);
						}
					},10);
				}else{
					col = col==4?4:col+1;
					timer2 = setInterval(function(){
						bl = bl==320?bl=320:bl+10;
						ele.style.left = bl+'px';
						if(bl == col*80){
							clearInterval(timer2);
						}
					},10);
				}
			}
			//加速下落
			function Down(ele){
				var target = 550;
				var bt = ele.offsetTop;
				clearInterval(timer1);
				if(bt<550){
					timer1 = setInterval(function(){
						bt+=speed;
						ele.style.top = bt+'px';
						if(bt >= target){
							ele.style.top = target+'px';
							console.log('到底了');
							clearInterval(timer1);
							var timer = setTimeout(function(){
								clearTimeout(timer);
								Create();
							},500)
						}
					},1);
				}
			}
		</script>
	</body>
</html>
